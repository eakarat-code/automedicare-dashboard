<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoMediCare - ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .menu-item:hover { background: linear-gradient(135deg, #0891B2 0%, #06B6D4 100%); }
        .active-menu { background: linear-gradient(135deg, #0891B2 0%, #06B6D4 100%); }
        .card-gradient { background: linear-gradient(135deg, #0891B2 0%, #06B6D4 100%); }
        .card-gradient-2 { background: linear-gradient(135deg, #0E7490 0%, #67E8F9 100%); }
        .card-gradient-3 { background: linear-gradient(135deg, #06B6D4 0%, #A7F3D0 100%); }
        .card-gradient-4 { background: linear-gradient(135deg, #0D9488 0%, #CCFBF1 100%); }
        .logo-gradient { background: linear-gradient(135deg, #0891B2 0%, #06B6D4 100%); }
        .login-bg { background: linear-gradient(135deg, #0891B2 0%, #06B6D4 50%, #0D9488 100%); }
        .login-card { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.95); }
    </style>
</head>
<body class="bg-cyan-50">
    <!-- Login Screen -->
    <div id="login-screen" class="min-h-screen login-bg flex items-center justify-center p-4">
        <div class="login-card rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <!-- Hospital Header -->
            <div class="text-center mb-8">
                <div class="logo-gradient w-20 h-20 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-2xl relative overflow-hidden" style="background: linear-gradient(145deg, #0891B2 0%, #06B6D4 50%, #0E7490 100%); box-shadow: 0 20px 40px rgba(8, 145, 178, 0.3), inset 0 1px 0 rgba(255,255,255,0.2);">
                    <!-- Medicine bottle with enhanced 3D effect -->
                    <svg class="w-14 h-14 text-white relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                        <!-- Medicine bottle shadow -->
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8.5 6.5V4.5c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2" stroke="rgba(0,0,0,0.3)" stroke-width="2"/>
                        <rect x="6.5" y="6.5" width="12" height="14" rx="2" ry="2" fill="rgba(0,0,0,0.2)"/>
                        
                        <!-- Main medicine bottle -->
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2" stroke="white" stroke-width="2"/>
                        <rect x="6" y="6" width="12" height="14" rx="2" ry="2" fill="rgba(255,255,255,0.15)" stroke="white" stroke-width="1.5"/>
                        
                        <!-- Enhanced cross symbol with 3D effect -->
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12.5 9.5v6M9.5 12.5h6" stroke="rgba(220, 38, 38, 0.8)" stroke-width="3"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6M9 12h6" stroke="#DC2626" stroke-width="2.5"/>
                        
                        <!-- Medicine pills inside bottle -->
                        <circle cx="10" cy="11" r="1" fill="rgba(255,255,255,0.6)"/>
                        <circle cx="14" cy="15" r="1" fill="rgba(255,255,255,0.6)"/>
                        <circle cx="11" cy="17" r="0.8" fill="rgba(255,255,255,0.5)"/>
                    </svg>
                    
                    <!-- 24 ‡∏ä‡∏°. indicator with enhanced styling -->
                    <div class="absolute top-1 right-1 w-8 h-8 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center shadow-lg border-2 border-white" style="box-shadow: 0 4px 12px rgba(220, 38, 38, 0.4);">
                        <div class="text-center">
                            <div class="text-white font-bold text-xs leading-none">24</div>
                            <div class="text-white font-medium text-[6px] leading-none">‡∏ä‡∏°.</div>
                        </div>
                    </div>
                    
                    <!-- Enhanced glow effects -->
                    <div class="absolute inset-0 rounded-2xl border border-white/20"></div>
                    <div class="absolute inset-0 rounded-2xl bg-gradient-to-t from-transparent to-white/10"></div>
                    <div class="absolute -inset-1 rounded-2xl border-2 border-cyan-300/30 animate-pulse"></div>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 mb-2">AutoMediCare</h1>
                <p class="text-gray-600 text-sm mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>
                <div class="bg-gradient-to-r from-cyan-100 to-teal-100 rounded-lg p-3 mt-4">
                    <p class="text-cyan-800 font-bold text-xl">‡∏£‡∏û‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
                    <p class="text-cyan-700 text-base">‡∏≠.‡∏≠‡πà‡∏≤‡∏ß‡∏•‡∏∂‡∏Å ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà</p>
                </div>
            </div>
            
            <!-- Login Form -->
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</label>
                    <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 transition-colors" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-teal-500 text-white py-3 px-4 rounded-lg font-medium hover:from-cyan-600 hover:to-teal-600 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                    üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
                </button>
            </form>
            

            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500">¬© 2025 AutoMediCare - ‡∏£‡∏û‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏≠.‡∏≠‡πà‡∏≤‡∏ß‡∏•‡∏∂‡∏Å ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà</p>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="main-dashboard" class="hidden">
        <div class="flex h-screen">
            <!-- Sidebar Menu -->
            <div class="w-64 bg-white shadow-lg">
                <div class="p-6 border-b border-gray-200">
                    <div class="flex items-center mb-3">
                        <div class="w-10 h-10 rounded-lg flex items-center justify-center mr-3 relative overflow-hidden shadow-lg" style="background: linear-gradient(145deg, #0891B2 0%, #06B6D4 50%, #0E7490 100%); box-shadow: 0 4px 12px rgba(8, 145, 178, 0.3), inset 0 1px 0 rgba(255,255,255,0.2);">
                            <svg class="w-7 h-7 text-white relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                <!-- Medicine bottle -->
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2" stroke="white" stroke-width="1.5"/>
                                <rect x="6" y="6" width="12" height="14" rx="2" ry="2" fill="rgba(255,255,255,0.15)" stroke="white" stroke-width="1"/>
                                <!-- Cross symbol -->
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6M9 12h6" stroke="#DC2626" stroke-width="2"/>
                                <!-- Pills -->
                                <circle cx="10" cy="11" r="0.8" fill="rgba(255,255,255,0.6)"/>
                                <circle cx="14" cy="15" r="0.8" fill="rgba(255,255,255,0.6)"/>
                            </svg>
                            <!-- 24 indicator -->
                            <div class="absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-br from-red-500 to-red-600 rounded-full flex items-center justify-center border border-white">
                                <span class="text-white font-bold text-[8px]">24</span>
                            </div>
                            <!-- Glow effect -->
                            <div class="absolute inset-0 rounded-lg border border-white/20"></div>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-gray-800">AutoMediCare</h1>
                            <p class="text-sm text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>
                        </div>
                    </div>
                </div>
                
                <nav class="mt-6">
                    <div class="px-4 space-y-2">
                        <button onclick="showSection('overview')" class="menu-item active-menu w-full text-left px-4 py-3 rounded-lg text-white font-medium transition-all duration-300 flex items-center">
                            <span class="mr-3">üìà</span>
                            ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°
                        </button>
                        
                        <button onclick="showSection('googlesheets')" class="menu-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white font-medium transition-all duration-300 flex items-center">
                            <span class="mr-3">üìã</span>
                            Google Sheets
                        </button>
                        
                        <button onclick="showSection('thingspeak')" class="menu-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white font-medium transition-all duration-300 flex items-center">
                            <span class="mr-3">üå°Ô∏è</span>
                            ThingSpeak
                        </button>
                        
                        <button onclick="showSection('telegram')" class="menu-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white font-medium transition-all duration-300 flex items-center">
                            <span class="mr-3">üì±</span>
                            Telegram
                        </button>
                        
                        <button onclick="showSection('analytics')" class="menu-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white font-medium transition-all duration-300 flex items-center">
                            <span class="mr-3">üìä</span>
                            ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                        </button>
                        
                        <button id="logout-btn" class="menu-item w-full text-left px-4 py-3 rounded-lg text-gray-700 hover:text-white font-medium transition-all duration-300 flex items-center mt-8 border-t border-gray-200 pt-4">
                            <span class="mr-3">üö™</span>
                            ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="flex-1 overflow-auto">
                <!-- Header -->
                <div class="bg-white shadow-sm border-b border-gray-200 p-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="flex items-center mb-2">
                                <h2 id="page-title" class="text-2xl font-bold text-gray-800 mr-4">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                                <div class="bg-gradient-to-r from-cyan-100 to-teal-100 px-4 py-2 rounded-lg">
                                    <p class="text-cyan-800 font-bold text-lg">‡∏£‡∏û‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏≠.‡∏≠‡πà‡∏≤‡∏ß‡∏•‡∏∂‡∏Å ‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà</p>
                                </div>
                            </div>
                            <p id="page-subtitle" class="text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                        <div class="flex items-center space-x-4">
                            <div class="text-right">
                                <p class="text-sm text-gray-600">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                                <p class="text-sm font-medium text-gray-800" id="last-update"></p>
                            </div>
                            <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                        </div>
                    </div>
                </div>

                <!-- Content Area -->
                <div class="p-6">
                    <!-- Overview Section -->
                    <div id="overview-section" class="section-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                            <div class="card-gradient p-6 rounded-xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">Google Sheets</p>
                                        <p class="text-2xl font-bold" id="sheets-latest">-</p>
                                        <p class="text-white/80 text-xs mt-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</p>
                                    </div>
                                    <div class="text-3xl">üìã</div>
                                </div>
                            </div>
                            
                            <div class="card-gradient-2 p-6 rounded-xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥</p>
                                        <p class="text-2xl font-bold" id="overview-temp">-</p>
                                        <p class="text-white/80 text-xs mt-1">Channel: 2994854</p>
                                    </div>
                                    <div class="text-3xl">üå°Ô∏è</div>
                                </div>
                            </div>
                            
                            <div class="card-gradient-3 p-6 rounded-xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</p>
                                        <p class="text-2xl font-bold" id="overview-humid">-</p>
                                        <p class="text-white/80 text-xs mt-1">Channel: 2994854</p>
                                    </div>
                                    <div class="text-3xl">üíß</div>
                                </div>
                            </div>
                            
                            <div class="card-gradient-4 p-6 rounded-xl text-white">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-white/80 text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
                                        <p class="text-2xl font-bold">‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                                        <p class="text-white/80 text-xs mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</p>
                                    </div>
                                    <div class="text-3xl">‚úÖ</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìà ‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</h3>
                                <canvas id="trendChart" width="400" height="200"></canvas>
                            </div>
                            
                            <div class="bg-white p-6 rounded-xl shadow-sm">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                                        <span class="font-semibold text-teal-500" id="avg-temp">24.8¬∞C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                                        <span class="font-semibold text-cyan-600" id="avg-humid">65%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤</span>
                                        <span class="font-semibold" id="storage-status">‡∏õ‡∏Å‡∏ï‡∏¥</span>
                                    </div>
                                    <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm text-blue-800 font-medium">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</p>
                                        <p class="text-xs text-blue-600 mt-1" id="daily-recommendation">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Google Sheets Section -->
                    <div id="googlesheets-section" class="section-content hidden">
                        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets</h3>
                                <button onclick="refreshGoogleSheets()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                                </button>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡πÄ‡∏ß‡∏•‡∏≤</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)</th>
                                            <th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sheets-data">
                                        <tr class="border-b border-gray-100">
                                            <td class="py-3 px-4">2025-01-15</td>
                                            <td class="py-3 px-4">14:30:25</td>
                                            <td class="py-3 px-4 font-semibold text-cyan-600">25.4</td>
                                            <td class="py-3 px-4 font-semibold text-blue-600">65</td>
                                            <td class="py-3 px-4"><span class="bg-teal-100 text-teal-800 px-2 py-1 rounded-full text-xs">‡∏õ‡∏Å‡∏ï‡∏¥</span></td>
                                        </tr>
                                        <tr class="border-b border-gray-100">
                                            <td class="py-3 px-4">2025-01-15</td>
                                            <td class="py-3 px-4">14:25:10</td>
                                            <td class="py-3 px-4 font-semibold text-red-600 bg-red-50 px-2 py-1 rounded">32.1</td>
                                            <td class="py-3 px-4 font-semibold text-red-600 bg-red-50 px-2 py-1 rounded">45</td>
                                            <td class="py-3 px-4"><span class="bg-orange-100 text-orange-800 px-2 py-1 rounded-full text-xs">‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</span></td>
                                        </tr>
                                        <tr class="border-b border-gray-100">
                                            <td class="py-3 px-4">2025-01-15</td>
                                            <td class="py-3 px-4">14:20:45</td>
                                            <td class="py-3 px-4 font-semibold text-cyan-600">24.8</td>
                                            <td class="py-3 px-4 font-semibold text-blue-600">58</td>
                                            <td class="py-3 px-4"><span class="bg-teal-100 text-teal-800 px-2 py-1 rounded-full text-xs">‡∏õ‡∏Å‡∏ï‡∏¥</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <p class="text-blue-800 font-medium text-sm">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
                                <div class="mt-2 space-y-1">
                                    <p class="text-blue-600 text-xs">
                                        <span class="inline-block w-3 h-3 bg-teal-500 rounded-full mr-2"></span>
                                        <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏Å‡∏ï‡∏¥:</strong> ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ 20.0-29.9¬∞C ‡πÅ‡∏•‡∏∞ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô 50.0-69.9% - ‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                                    </p>
                                    <p class="text-blue-600 text-xs">
                                        <span class="inline-block w-3 h-3 bg-orange-500 rounded-full mr-2"></span>
                                        <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 20.0¬∞C ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 29.9¬∞C ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 50.0% ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ 69.9% - ‡∏Ñ‡πà‡∏≤‡πÉ‡∏î‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏Ñ‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                                    </p>
                                    <p class="text-blue-600 text-xs mt-2">
                                        üé® ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå
                                    </p>
                                </div>
                            </div>
                            
                            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-lg border border-green-200">
                                <div class="text-center">
                                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full mb-4 shadow-lg">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                    </div>
                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">‡πÄ‡∏õ‡∏¥‡∏î Google Sheets</h4>
                                    <p class="text-sm text-gray-600 mb-4">‡∏î‡∏π‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô Google Sheets</p>
                                    <a href="https://docs.google.com/spreadsheets/d/1aS2Fw7cmMvHVUtZpycuaN6nvGWNTrU0g0RazCBvmNK4/edit?usp=sharing" 
                                       target="_blank" 
                                       class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white font-medium rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                        ‡πÄ‡∏õ‡∏¥‡∏î Sheets
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ThingSpeak Section -->
                    <div id="thingspeak-section" class="section-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)</h3>
                                <div class="text-center">
                                    <div class="text-4xl font-bold text-red-500 mb-2" id="temperature">25.6</div>
                                    <div class="text-sm text-gray-600">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="temp-time">14:30:25</span></div>
                                </div>
                                <canvas id="tempChart" width="400" height="200" class="mt-4"></canvas>
                            </div>
                            
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h3 class="text-lg font-semibold text-gray-800 mb-4">üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)</h3>
                                <div class="text-center">
                                    <div class="text-4xl font-bold text-blue-500 mb-2" id="humidity">68</div>
                                    <div class="text-sm text-gray-600">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="humid-time">14:30:25</span></div>
                                </div>
                                <canvas id="humidChart" width="400" height="200" class="mt-4"></canvas>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak</h3>
                                <button onclick="refreshThingSpeak()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                                </button>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-gray-600 text-sm">Channel ID</p>
                                    <p class="font-semibold">2994854</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-gray-600 text-sm">Field 1 (‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥)</p>
                                    <p class="font-semibold text-teal-500">25.6¬∞C</p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <p class="text-gray-600 text-sm">Field 2 (‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô)</p>
                                    <p class="font-semibold text-cyan-600">68%</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <p class="text-green-800 font-medium text-sm">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak</p>
                                <p class="text-green-600 text-xs mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak API ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ</p>
                                <p class="text-green-600 text-xs">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå</p>
                            </div>
                            
                            <div class="bg-gradient-to-br from-blue-50 to-indigo-50 p-6 rounded-lg border border-blue-200">
                                <div class="text-center">
                                    <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full mb-4 shadow-lg">
                                        <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <h4 class="text-lg font-semibold text-gray-800 mb-2">‡πÄ‡∏õ‡∏¥‡∏î ThingSpeak</h4>
                                    <p class="text-sm text-gray-600 mb-4">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</p>
                                    <a href="https://thingspeak.mathworks.com/channels/2994854" 
                                       target="_blank" 
                                       class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
                                        </svg>
                                        ‡πÄ‡∏õ‡∏¥‡∏î ThingSpeak
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Telegram Section -->
                    <div id="telegram-section" class="section-content hidden">
                        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">üì± ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å ThingSpeak</h3>
                                <div class="flex space-x-3">
                                    <button onclick="checkThingSpeakAlerts()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                        üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                                    </button>
                                    <button onclick="clearAlertHistory()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                        üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
                                    </button>
                                    <a href="https://web.telegram.org/k/#-4926671751" 
                                       target="_blank" 
                                       class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-medium rounded-lg hover:from-blue-600 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 text-sm">
                                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                                        </svg>
                                        Telegram
                                    </a>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="telegram-current-alerts">
                                    <div class="bg-white p-3 rounded-lg border" id="system-status-card">
                                        <div class="flex items-center">
                                            <div class="text-lg mr-2" id="system-status-icon">‚è≥</div>
                                            <div>
                                                <p class="font-medium text-gray-800 text-sm" id="system-status-text">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</p>
                                                <p class="text-xs text-gray-600" id="system-status-detail">‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak</p>
                                                <p class="text-xs text-gray-500" id="system-status-time">-</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white p-3 rounded-lg border border-blue-200">
                                        <div class="flex items-center">
                                            <div class="text-lg mr-2">üìä</div>
                                            <div>
                                                <p class="font-medium text-blue-800 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                                <p class="text-xs text-blue-600" id="daily-records-count">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
                                                <p class="text-xs text-gray-500" id="last-record-time">‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: -</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-white p-3 rounded-lg border border-cyan-200">
                                        <div class="flex items-center">
                                            <div class="text-lg mr-2">üîÑ</div>
                                            <div>
                                                <p class="font-medium text-cyan-800 text-sm">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</p>
                                                <p class="text-xs text-cyan-600">ThingSpeak Channel: 2994854</p>
                                                <p class="text-xs text-gray-500" id="connection-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-800 mb-3">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏≤‡∏Å ThingSpeak</h4>
                                <div class="space-y-3 max-h-64 overflow-y-auto" id="telegram-alerts">
                                    <div class="text-center text-gray-500 py-4">
                                        <div class="text-4xl mb-2">üì°</div>
                                        <p class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                                        <p class="text-xs">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-xl shadow-sm p-6">
                            <h4 class="font-semibold text-gray-800 mb-4">üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á</h4>
                            <div class="space-y-3" id="telegram-stats">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
                                    <span class="font-semibold text-green-600" id="alerts-today">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</span>
                                    <span class="font-semibold text-green-600" id="alerts-week">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
                                    <span class="font-semibold text-green-600" id="alerts-month">0 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</span>
                                </div>
                                <div class="mt-4 p-3 bg-green-50 rounded-lg">
                                    <p class="text-sm text-green-800 font-medium">üí° ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</p>
                                    <p class="text-xs text-green-600 mt-1" id="recommendation">‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <p class="text-blue-800 font-medium text-sm">‚ÑπÔ∏è ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö Telegram</p>
                            <div class="mt-2 space-y-1">
                                <p class="text-blue-600 text-xs">
                                    üîç <strong>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å ThingSpeak ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
                                </p>
                                <p class="text-blue-600 text-xs">
                                    ‚ö†Ô∏è <strong>‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô:</strong> ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ 20.0-29.9¬∞C, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô 50.0-69.9%
                                </p>
                                <p class="text-blue-600 text-xs">
                                    üìä <strong>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥:</strong> ‡πÅ‡∏™‡∏î‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö (‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£)
                                </p>
                                <p class="text-blue-600 text-xs">
                                    üóëÔ∏è <strong>‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥:</strong> ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </p>
                                <p class="text-blue-600 text-xs">
                                    üì± <strong>Telegram:</strong> ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏° Telegram ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                                </p>
                                <p class="text-blue-600 text-xs">
                                    üíæ <strong>‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ 1 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏à‡∏∞‡∏™‡∏∞‡∏™‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics Section -->
                    <div id="analytics-section" class="section-content hidden">
                        <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-800">üìä ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤</h3>
                                <div class="flex items-center space-x-3">
                                    <button onclick="refreshAnalytics()" class="bg-cyan-500 hover:bg-cyan-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                        </svg>
                                        ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                                    </button>
                                    <div class="flex items-center space-x-2">
                                        <label class="text-sm text-gray-600">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå:</label>
                                        <select id="weekSelector" onchange="changeAnalyticsWeek()" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                                            <option value="0">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</option>
                                            <option value="1">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                            <option value="2">2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                            <option value="3">3 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                            <option value="4">4 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-blue-50 p-4 rounded-lg mb-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold text-blue-800" id="current-week-title">‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ (15-21 ‡∏°.‡∏Ñ. 2568)</h4>
                                        <p class="text-sm text-blue-600" id="week-summary">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Google Sheets</p>
                                        <div class="flex items-center mt-2">
                                            <div class="w-2 h-2 bg-green-400 rounded-full mr-2 animate-pulse" id="ai-status-indicator"></div>
                                            <p class="text-xs text-gray-600" id="ai-analysis-status">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-blue-800" id="week-score">87%</div>
                                        <div class="text-xs text-blue-600">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û</div>
                                        <div class="text-xs text-gray-500 mt-1" id="last-analysis-time">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: -</div>
                                    </div>
                                </div>
                            </div>
                            
                            <canvas id="analyticsChart" width="400" height="200"></canvas>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h4 class="font-semibold text-gray-800 mb-4">üå°Ô∏è ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                                        <span class="font-semibold text-teal-600" id="analytics-avg-temp">24.8¬∞C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                                        <span class="font-semibold text-red-500" id="analytics-max-temp">32.1¬∞C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</span>
                                        <span class="font-semibold text-blue-500" id="analytics-min-temp">18.5¬∞C</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥</span>
                                        <span class="font-semibold text-green-600" id="analytics-temp-normal">6/7 ‡∏ß‡∏±‡∏ô</span>
                                    </div>
                                    <div class="mt-3 p-3 bg-orange-50 rounded-lg">
                                        <p class="text-sm text-orange-800 font-medium">‚ö†Ô∏è ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï</p>
                                        <p class="text-xs text-orange-600 mt-1" id="temp-analysis">‡∏°‡∏µ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏Å‡∏¥‡∏ô 30¬∞C ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô 7 ‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-white rounded-xl shadow-sm p-6">
                                <h4 class="font-semibold text-gray-800 mb-4">üíß ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h4>
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</span>
                                        <span class="font-semibold text-cyan-600" id="analytics-avg-humid">62%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</span>
                                        <span class="font-semibold text-blue-500" id="analytics-max-humid">78%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î</span>
                                        <span class="font-semibold text-orange-500" id="analytics-min-humid">35%</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥</span>
                                        <span class="font-semibold text-green-600" id="analytics-humid-normal">5/7 ‡∏ß‡∏±‡∏ô</span>
                                    </div>
                                    <div class="mt-3 p-3 bg-blue-50 rounded-lg">
                                        <p class="text-sm text-blue-800 font-medium">‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï</p>
                                        <p class="text-xs text-blue-600 mt-1" id="humid-analysis">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 50%</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        

                        
                        <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-6 rounded-xl">
                            <div class="flex items-center justify-between mb-4">
                                <h4 class="font-semibold text-gray-800">ü§ñ AI ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h4>
                                <div class="flex items-center space-x-2">
                                    <div class="w-2 h-2 rounded-full" id="risk-indicator"></div>
                                    <span class="text-xs font-medium" id="risk-level-text">‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: -</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="font-medium text-blue-800 mb-3">üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å‡∏à‡∏≤‡∏Å AI</h5>
                                    <div class="space-y-2 text-sm text-blue-700" id="ai-insights">
                                        <p>‚Ä¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="font-medium text-green-800 mb-3">üí° ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏à‡∏≤‡∏Å AI</h5>
                                    <div class="space-y-2 text-sm text-green-700" id="ai-recommendations">
                                        <p>‚Ä¢ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 p-3 bg-white/50 rounded-lg">
                                <p class="text-sm font-medium text-gray-800">üìã ‡∏™‡∏£‡∏∏‡∏õ‡∏à‡∏≤‡∏Å AI:</p>
                                <p class="text-sm text-gray-700 mt-1" id="ai-summary">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-gradient-to-r from-cyan-800 to-teal-700 text-white">
            <div class="max-w-7xl mx-auto px-6 py-12">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <!-- AutoMediCare Info -->
                    <div class="space-y-4">
                        <div class="flex items-center mb-4">
                            <div class="bg-white/20 w-12 h-12 rounded-lg flex items-center justify-center mr-4 relative overflow-hidden">
                                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                                    <!-- Medicine bottle with cross -->
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/>
                                    <rect x="6" y="6" width="12" height="14" rx="2" ry="2" fill="rgba(255,255,255,0.2)"/>
                                    <!-- Cross symbol -->
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6M9 12h6" stroke-width="2"/>
                                </svg>
                                <!-- Subtle glow effect -->
                                <div class="absolute inset-0 rounded-lg border border-white/20"></div>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">AutoMediCare</h3>
                                <p class="text-cyan-100 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</p>
                            </div>
                        </div>
                        <p class="text-cyan-100 leading-relaxed">
                            ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏á‡πà‡∏≤‡∏¢ ‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û
                        </p>
                        <div class="bg-white/10 p-4 rounded-lg">
                            <p class="text-white font-semibold text-lg">"AutoMediCare ‡∏î‡∏π‡πÅ‡∏•‡∏¢‡∏≤ ‡πÄ‡∏£‡∏≤‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏∏‡∏ì"</p>
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="space-y-4">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <svg class="w-6 h-6 mr-3 text-cyan-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                            </svg>
                            ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤
                        </h4>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <div class="bg-cyan-400/20 p-2 rounded-lg">
                                    <svg class="w-5 h-5 text-cyan-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="font-bold text-lg">‡∏£‡∏û‡∏™‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
                                    <p class="text-cyan-100 text-base">‡∏ï.‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏≠.‡∏≠‡πà‡∏≤‡∏ß‡∏•‡∏∂‡∏Å</p>
                                    <p class="text-cyan-100 text-base">‡∏à.‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà 81110</p>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <div class="bg-cyan-400/20 p-2 rounded-lg">
                                    <svg class="w-5 h-5 text-cyan-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-cyan-100 text-sm">‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πå</p>
                                    <a href="mailto:eakarat@ap.ac.th" class="text-white hover:text-cyan-200 transition-colors">
                                        eakarat@ap.ac.th
                                    </a>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <div class="bg-cyan-400/20 p-2 rounded-lg">
                                    <svg class="w-5 h-5 text-cyan-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <div>
                                    <p class="text-cyan-100 text-sm">‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</p>
                                    <a href="tel:0818939138" class="text-white hover:text-cyan-200 transition-colors">
                                        081-893-9138
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Credits -->
                    <div class="space-y-4">
                        <h4 class="text-xl font-semibold mb-4 flex items-center">
                            <svg class="w-6 h-6 mr-3 text-cyan-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï
                        </h4>
                        <div class="space-y-3">
                            <div class="bg-white/10 p-4 rounded-lg">
                                <p class="font-medium text-white mb-2">‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢</p>
                                <p class="text-cyan-100 text-sm">‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö AutoMediCare</p>
                            </div>
                            
                            <div class="bg-white/10 p-4 rounded-lg">
                                <p class="font-medium text-white mb-2">‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡πÇ‡∏î‡∏¢</p>
                                <p class="text-cyan-100 text-sm">‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ï‡∏≥‡∏ö‡∏•‡∏ö‡πâ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Bottom Bar -->
                <div class="border-t border-white/20 mt-8 pt-6">
                    <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                        <div class="flex items-center space-x-4">
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-cyan-100 text-sm">‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
                            </div>
                            <div class="text-cyan-100 text-sm">|</div>
                            <span class="text-cyan-100 text-sm">‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô 1.0.0</span>
                        </div>
                        
                        <div class="text-center">
                            <p class="text-cyan-100 text-sm">
                                ¬© 2025 AutoMediCare - ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤ 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
                            </p>
                            <p class="text-cyan-200 text-xs mt-1">‡∏™‡∏á‡∏ß‡∏ô‡∏•‡∏¥‡∏Ç‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                        </div>
                        
                        <div class="flex items-center space-x-3">
                            <span class="text-cyan-100 text-sm">‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏≤:</span>
                            <div class="flex space-x-2">
                                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors cursor-pointer">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.097.118.112.221.083.343-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.017z"/>
                                    </svg>
                                </div>
                                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors cursor-pointer">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                                    </svg>
                                </div>
                                <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center hover:bg-white/30 transition-colors cursor-pointer">
                                    <svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
                                        <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                                    </svg>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Global variables for alert tracking with persistent storage
        let alertCounts = {
            today: 0,
            week: 0,
            month: 0
        };
        
        // Alert history storage
        let alertHistory = [];
        
        // Initialize alert data from localStorage
        function initializeAlertData() {
            try {
                const savedCounts = localStorage.getItem('automedicare_alert_counts');
                const savedHistory = localStorage.getItem('automedicare_alert_history');
                
                if (savedCounts) {
                    alertCounts = JSON.parse(savedCounts);
                }
                
                if (savedHistory) {
                    alertHistory = JSON.parse(savedHistory);
                    // Clean old alerts (older than 1 day)
                    cleanOldAlerts();
                    // Update display
                    displayAlertHistory();
                }
                
                updateAlertStats();
            } catch (error) {
                console.error('Error loading alert data:', error);
            }
        }
        
        // Save alert data to localStorage
        function saveAlertData() {
            try {
                localStorage.setItem('automedicare_alert_counts', JSON.stringify(alertCounts));
                localStorage.setItem('automedicare_alert_history', JSON.stringify(alertHistory));
            } catch (error) {
                console.error('Error saving alert data:', error);
            }
        }
        
        // Clean alerts older than 1 day
        function cleanOldAlerts() {
            const oneDayAgo = new Date().getTime() - (24 * 60 * 60 * 1000);
            alertHistory = alertHistory.filter(alert => alert.timestamp > oneDayAgo);
        }
        
        // Display alert history in UI
        function displayAlertHistory() {
            const alertsContainer = document.getElementById('telegram-alerts');
            if (!alertsContainer) return;
            
            alertsContainer.innerHTML = '';
            
            if (alertHistory.length === 0) {
                alertsContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-4">
                        <div class="text-4xl mb-2">üì°</div>
                        <p class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</p>
                        <p class="text-xs">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</p>
                    </div>
                `;
                return;
            }
            
            // Sort by timestamp (newest first)
            const sortedAlerts = [...alertHistory].sort((a, b) => b.timestamp - a.timestamp);
            
            sortedAlerts.forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'flex items-start space-x-3 p-3 bg-white rounded-lg';
                
                const colors = {
                    'success': 'text-green-500',
                    'warning': 'text-yellow-500',
                    'error': 'text-red-500',
                    'info': 'text-blue-500'
                };
                
                const alertTime = new Date(alert.timestamp);
                const now = new Date();
                const isToday = alertTime.toDateString() === now.toDateString();
                const timeDisplay = isToday ? 
                    alertTime.toLocaleTimeString('th-TH') + ' - ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ' :
                    alertTime.toLocaleString('th-TH');
                
                alertDiv.innerHTML = `
                    <div class="${colors[alert.type]} text-lg">${alert.icon}</div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800">${alert.title}</p>
                        <p class="text-xs text-gray-600">${alert.message}</p>
                        <p class="text-xs text-gray-400">${timeDisplay}</p>
                    </div>
                `;
                
                alertsContainer.appendChild(alertDiv);
            });
        }

        // Global variables for analytics
        let currentWeekOffset = 0;
        let weeklyAnalyticsData = {};
        let analyticsChart = null;

        // Login functionality
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Simple authentication (in real app, this would be server-side)
            if (username === 'admin' && password === '09033') {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('main-dashboard').classList.remove('hidden');
                
                // Initialize dashboard
                updateTime();
                setInterval(updateTime, 1000);
                setTimeout(initCharts, 100);
                
                // Initialize alert data from localStorage
                initializeAlertData();
                
                // Load initial data
                setTimeout(() => {
                    refreshThingSpeak();
                    refreshGoogleSheets();
                }, 2000);
                
                // Auto-update every 5 minutes
                setInterval(() => {
                    refreshThingSpeak();
                }, 300000);
                
                // Auto-refresh analytics every 10 minutes
                setInterval(() => {
                    refreshAnalytics();
                }, 600000);
                
                // Auto-save alert data every minute
                setInterval(() => {
                    saveAlertData();
                }, 60000);
            } else {
                alert('‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
            }
        });

        // Add logout button event listener
        document.addEventListener('DOMContentLoaded', function() {
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    logout();
                });
            }
        });

        // Logout functionality
        function logout() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                // Save alert data before logout
                saveAlertData();
                
                document.getElementById('main-dashboard').classList.add('hidden');
                document.getElementById('login-screen').classList.remove('hidden');
                
                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                // Don't reset alert counts - keep them persistent
                // alertCounts and alertHistory will be loaded again on next login
            }
        }

        // Update time
        function updateTime() {
            const now = new Date();
            document.getElementById('last-update').textContent = now.toLocaleString('th-TH');
        }
        
        // Menu navigation
        function showSection(sectionName) {
            // Hide all sections
            const sections = document.querySelectorAll('.section-content');
            sections.forEach(section => section.classList.add('hidden'));
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.remove('hidden');
            
            // Update menu active state
            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => {
                item.classList.remove('active-menu');
                item.classList.add('text-gray-700', 'hover:text-white');
                item.classList.remove('text-white');
            });
            
            event.target.classList.add('active-menu', 'text-white');
            event.target.classList.remove('text-gray-700', 'hover:text-white');
            
            // Update page title
            const titles = {
                'overview': { title: '‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö', subtitle: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' },
                'googlesheets': { title: 'Google Sheets', subtitle: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏™‡πÄ‡∏õ‡∏£‡∏î‡∏ä‡∏µ‡∏ï' },
                'thingspeak': { title: 'ThingSpeak', subtitle: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ã‡∏ô‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå' },
                'telegram': { title: 'Telegram', subtitle: '‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥' },
                'analytics': { title: '‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå', subtitle: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•' }
            };
            
            document.getElementById('page-title').textContent = titles[sectionName].title;
            document.getElementById('page-subtitle').textContent = titles[sectionName].subtitle;
        }
        
        // Refresh functions
        async function refreshGoogleSheets() {
            try {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
                const sheetsLatestElement = document.getElementById('sheets-latest');
                if (sheetsLatestElement) {
                    sheetsLatestElement.textContent = '...';
                }
                
                // ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets API
                const sheetId = '1aS2Fw7cmMvHVUtZpycuaN6nvGWNTrU0g0RazCBvmNK4';
                const range = 'Sheet1!A:Z'; // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                
                // ‡πÉ‡∏ä‡πâ Google Sheets API ‡πÅ‡∏ö‡∏ö Public (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API Key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Public sheets)
                const csvUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/export?format=csv&gid=0`;
                
                try {
                    const response = await fetch(csvUrl);
                    if (response.ok) {
                        const csvData = await response.text();
                        const rows = csvData.split('\n').filter(row => row.trim() !== '');
                        
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        updateSheetsTable(rows);
                        
                        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                        updateOverviewFromSheets(rows);
                        
                        console.log('‚úÖ Google Sheets data updated successfully');
                    } else {
                        throw new Error('Cannot access Google Sheets');
                    }
                } catch (fetchError) {
                    // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
                    generateSampleSheetsData();
                    console.log('üìä Using sample data for Google Sheets');
                }
                
            } catch (error) {
                if (sheetsLatestElement) {
                    sheetsLatestElement.textContent = 'Error';
                }
                console.error('Error fetching Google Sheets data:', error);
            }
        }
        
        function generateSampleSheetsData() {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á 7 ‡∏ß‡∏±‡∏ô
            const sampleRows = ['Date,Time,Temperature,Humidity']; // ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            const now = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(now.getTime() - (i * 24 * 60 * 60 * 1000));
                const recordsPerDay = Math.floor(Math.random() * 20) + 10; // 10-30 records per day
                
                for (let j = 0; j < recordsPerDay; j++) {
                    const hour = Math.floor(Math.random() * 24);
                    const minute = Math.floor(Math.random() * 60);
                    const second = Math.floor(Math.random() * 60);
                    
                    const temp = (Math.random() * 15 + 18).toFixed(1); // 18-33¬∞C
                    const humid = Math.floor(Math.random() * 40 + 40); // 40-80%
                    
                    const dateStr = date.toLocaleDateString('en-CA'); // YYYY-MM-DD
                    const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}:${second.toString().padStart(2, '0')}`;
                    
                    sampleRows.push(`${dateStr},${timeStr},${temp},${humid}`);
                }
            }
            
            updateSheetsTable(sampleRows);
            updateOverviewFromSheets(sampleRows);
        }
        
        function updateOverviewFromSheets(rows) {
            if (rows.length < 2) return;
            
            const dataRows = rows.slice(1); // ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
            const sheetsLatestElement = document.getElementById('sheets-latest');
            const avgTempElement = document.getElementById('avg-temp');
            const avgHumidElement = document.getElementById('avg-humid');
            const storageStatusElement = document.getElementById('storage-status');
            const dailyRecommendationElement = document.getElementById('daily-recommendation');
            
            if (dataRows.length > 0) {
                // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const latestRow = dataRows[dataRows.length - 1].split(',');
                const latestTemp = parseFloat(latestRow[2]) || 0;
                const latestHumid = parseInt(latestRow[3]) || 0;
                
                if (sheetsLatestElement) {
                    sheetsLatestElement.textContent = `${latestTemp}¬∞C, ${latestHumid}%`;
                }
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                const today = new Date().toLocaleDateString('en-CA');
                const todayData = dataRows.filter(row => {
                    const rowDate = row.split(',')[0];
                    return rowDate === today;
                });
                
                let todayTempSum = 0, todayHumidSum = 0, todayValidRecords = 0;
                
                todayData.forEach(row => {
                    const cols = row.split(',');
                    const temp = parseFloat(cols[2]);
                    const humid = parseInt(cols[3]);
                    
                    if (!isNaN(temp) && !isNaN(humid)) {
                        todayTempSum += temp;
                        todayHumidSum += humid;
                        todayValidRecords++;
                    }
                });
                
                if (todayValidRecords > 0) {
                    const avgTemp = (todayTempSum / todayValidRecords).toFixed(1);
                    const avgHumid = Math.round(todayHumidSum / todayValidRecords);
                    
                    if (avgTempElement) {
                        avgTempElement.textContent = `${avgTemp}¬∞C`;
                    }
                    if (avgHumidElement) {
                        avgHumidElement.textContent = `${avgHumid}%`;
                    }
                    
                    // ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏•‡∏±‡∏á‡∏¢‡∏≤
                    const tempOk = avgTemp >= 20 && avgTemp <= 29.9;
                    const humidOk = avgHumid >= 50 && avgHumid <= 69.9;
                    
                    let status = '‡∏õ‡∏Å‡∏ï‡∏¥';
                    let statusColor = 'text-green-600';
                    let recommendation = '‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°';
                    
                    if (!tempOk || !humidOk) {
                        status = '‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°';
                        statusColor = 'text-orange-600';
                        
                        if (!tempOk && !humidOk) {
                            recommendation = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
                        } else if (!tempOk) {
                            if (avgTemp > 29.9) {
                                recommendation = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô';
                            } else {
                                recommendation = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô';
                            }
                        } else if (!humidOk) {
                            if (avgHumid > 69.9) {
                                recommendation = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô';
                            } else {
                                recommendation = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®';
                            }
                        }
                    }
                    
                    if (storageStatusElement) {
                        storageStatusElement.textContent = status;
                        storageStatusElement.className = `font-semibold ${statusColor}`;
                    }
                    
                    if (dailyRecommendationElement) {
                        dailyRecommendationElement.textContent = recommendation;
                    }
                }
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°
                updateTrendChart(dataRows);
            }
        }
        
        function updateTrendChart(dataRows) {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡∏ü 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            const dailyData = {};
            const last7Days = [];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ 7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toLocaleDateString('en-CA');
                const dayName = date.toLocaleDateString('th-TH', { weekday: 'short' });
                
                last7Days.push({ date: dateStr, name: dayName });
                dailyData[dateStr] = { temps: [], humids: [] };
            }
            
            // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô
            dataRows.forEach(row => {
                const cols = row.split(',');
                const date = cols[0];
                const temp = parseFloat(cols[2]);
                const humid = parseInt(cols[3]);
                
                if (dailyData[date] && !isNaN(temp) && !isNaN(humid)) {
                    dailyData[date].temps.push(temp);
                    dailyData[date].humids.push(humid);
                }
            });
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
            const tempData = [];
            const humidData = [];
            const labels = [];
            
            last7Days.forEach(day => {
                const dayData = dailyData[day.date];
                labels.push(day.name);
                
                if (dayData.temps.length > 0) {
                    const avgTemp = dayData.temps.reduce((a, b) => a + b, 0) / dayData.temps.length;
                    const avgHumid = dayData.humids.reduce((a, b) => a + b, 0) / dayData.humids.length;
                    tempData.push(parseFloat(avgTemp.toFixed(1)));
                    humidData.push(Math.round(avgHumid));
                } else {
                    // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    tempData.push(parseFloat((Math.random() * 8 + 20).toFixed(1)));
                    humidData.push(Math.floor(Math.random() * 30 + 50));
                }
            });
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
            if (window.trendChart) {
                window.trendChart.data.labels = labels;
                window.trendChart.data.datasets[0].data = tempData;
                window.trendChart.data.datasets[1].data = humidData;
                window.trendChart.update();
            }
        }
        
        function updateSheetsTable(rows) {
            const tbody = document.getElementById('sheets-data');
            if (!tbody || rows.length < 2) return;
            
            tbody.innerHTML = '';
            
            // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 12 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤)
            const dataRows = rows.slice(1); // ‡∏ï‡∏±‡∏î‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
            const maxRows = Math.min(12, dataRows.length); // ‡πÄ‡∏≠‡∏≤‡πÅ‡∏Ñ‡πà 12 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏Å‡∏•‡∏±‡∏ö‡∏•‡∏≥‡∏î‡∏±‡∏ö)
            const latestRows = dataRows.slice(-maxRows).reverse();
            
            for (let i = 0; i < latestRows.length; i++) {
                const cols = latestRows[i].split(',');
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100';
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
                const now = new Date();
                const minutesAgo = i * 5; // ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏ñ‡∏ß‡∏´‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô 5 ‡∏ô‡∏≤‡∏ó‡∏µ
                const recordTime = new Date(now.getTime() - (minutesAgo * 60000));
                
                const date = cols[0] || recordTime.toLocaleDateString('th-TH');
                const time = cols[1] || recordTime.toLocaleTimeString('th-TH');
                const temp = parseFloat(cols[2]) || (Math.random() * 15 + 18).toFixed(1);
                const humid = parseInt(cols[3]) || Math.floor(Math.random() * 40 + 40);
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå
                const tempNum = parseFloat(temp);
                const humidNum = parseInt(humid);
                const isNormal = (tempNum >= 20 && tempNum <= 29.9) && (humidNum >= 50 && humidNum <= 69.9);
                const status = isNormal ? '‡∏õ‡∏Å‡∏ï‡∏¥' : '‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
                const statusClass = isNormal ? 'bg-teal-100 text-teal-800' : 'bg-orange-100 text-orange-800';
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏µ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ó‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                const tempClass = (tempNum >= 20 && tempNum <= 29.9) ? 'font-semibold text-cyan-600' : 'font-semibold text-red-600 bg-red-50 px-2 py-1 rounded';
                const humidClass = (humidNum >= 50 && humidNum <= 69.9) ? 'font-semibold text-blue-600' : 'font-semibold text-red-600 bg-red-50 px-2 py-1 rounded';
                
                row.innerHTML = `
                    <td class="py-3 px-4">${date}</td>
                    <td class="py-3 px-4">${time}</td>
                    <td class="py-3 px-4 ${tempClass}">${temp}</td>
                    <td class="py-3 px-4 ${humidClass}">${humid}</td>
                    <td class="py-3 px-4">
                        <span class="${statusClass} px-2 py-1 rounded-full text-xs">
                            ${status}
                        </span>
                    </td>
                `;
                
                tbody.appendChild(row);
            }
        }
        
        async function refreshThingSpeak() {
            try {
                // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î
                document.getElementById('temperature').textContent = '...';
                document.getElementById('humidity').textContent = '...';
                document.getElementById('overview-temp').textContent = '...';
                document.getElementById('overview-humid').textContent = '...';
                
                // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak API
                const channelId = '2994854';
                const apiKey = 'FMW2ZPWUNV949GSV';
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                const lastResponse = await fetch(`https://api.thingspeak.com/channels/${channelId}/feeds/last.json?api_key=${apiKey}`);
                
                // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü
                const feedsResponse = await fetch(`https://api.thingspeak.com/channels/${channelId}/feeds.json?api_key=${apiKey}&results=20`);
                
                if (lastResponse.ok && feedsResponse.ok) {
                    const lastData = await lastResponse.json();
                    const feedsData = await feedsResponse.json();
                    
                    const temp = parseFloat(lastData.field1 || 0).toFixed(1);
                    const humid = Math.round(parseFloat(lastData.field2 || 0));
                    const lastUpdate = new Date(lastData.created_at).toLocaleTimeString('th-TH');
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                    updateThingSpeakData(temp, humid, lastUpdate);
                    
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
                    updateThingSpeakCharts(feedsData.feeds);
                    
                    console.log('‚úÖ ThingSpeak data updated successfully');
                } else {
                    throw new Error('Failed to fetch data from ThingSpeak');
                }
                
            } catch (error) {
                // ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
                const temp = (Math.random() * 15 + 18).toFixed(1); // 18-33¬∞C
                const humid = Math.floor(Math.random() * 40 + 40); // 40-80%
                const time = new Date().toLocaleTimeString('th-TH');
                
                updateThingSpeakData(temp, humid, time);
                generateSampleThingSpeakCharts();
                
                console.error('Error fetching ThingSpeak data:', error);
            }
        }
        
        function updateThingSpeakData(temp, humid, time = null) {
            const tempNum = parseFloat(temp);
            const humidNum = parseInt(humid);
            const displayTime = time || new Date().toLocaleTimeString('th-TH');
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
            document.getElementById('temperature').textContent = temp;
            document.getElementById('humidity').textContent = humid;
            document.getElementById('overview-temp').textContent = temp + '¬∞C';
            document.getElementById('overview-humid').textContent = humid + '%';
            document.getElementById('temp-time').textContent = displayTime;
            document.getElementById('humid-time').textContent = displayTime;
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏ô Telegram section
            updateTelegramStatus(tempNum, humidNum, displayTime);
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
            checkAndCreateAlert(tempNum, humidNum, displayTime);
        }
        
        function updateTelegramStatus(temp, humid, time) {
            const statusCard = document.getElementById('system-status-card');
            const statusIcon = document.getElementById('system-status-icon');
            const statusText = document.getElementById('system-status-text');
            const statusDetail = document.getElementById('system-status-detail');
            const statusTime = document.getElementById('system-status-time');
            const connectionStatus = document.getElementById('connection-status');
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏ì‡∏ë‡πå
            const tempOk = temp >= 20.0 && temp <= 29.9;
            const humidOk = humid >= 50.0 && humid <= 69.9;
            const isNormal = tempOk && humidOk;
            
            if (isNormal) {
                statusCard.className = 'bg-white p-3 rounded-lg border border-green-200';
                statusIcon.textContent = '‚úÖ';
                statusText.textContent = '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥';
                statusText.className = 'font-medium text-green-800 text-sm';
                statusDetail.textContent = `‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: ${temp}¬∞C, ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${humid}%`;
                statusDetail.className = 'text-xs text-green-600';
            } else {
                statusCard.className = 'bg-white p-3 rounded-lg border border-red-200';
                statusIcon.textContent = 'üö®';
                statusText.textContent = '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
                statusText.className = 'font-medium text-red-800 text-sm';
                
                let alertDetails = [];
                if (!tempOk) {
                    if (temp > 29.9) {
                        alertDetails.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á: ${temp}¬∞C`);
                    } else {
                        alertDetails.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥: ${temp}¬∞C`);
                    }
                }
                if (!humidOk) {
                    if (humid > 69.9) {
                        alertDetails.push(`‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á: ${humid}%`);
                    } else {
                        alertDetails.push(`‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥: ${humid}%`);
                    }
                }
                
                statusDetail.textContent = alertDetails.join(', ');
                statusDetail.className = 'text-xs text-red-600';
            }
            
            statusTime.textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${time}`;
            connectionStatus.textContent = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
            const dailyCount = document.getElementById('daily-records-count');
            const lastRecord = document.getElementById('last-record-time');
            if (dailyCount && lastRecord) {
                const currentCount = parseInt(dailyCount.textContent.match(/\d+/)?.[0] || 0) + 1;
                dailyCount.textContent = `‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ${currentCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
                lastRecord.textContent = `‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ${time}`;
            }
        }
        
        function checkAndCreateAlert(temp, humid, time) {
            const tempOk = temp >= 20.0 && temp <= 29.9;
            const humidOk = humid >= 50.0 && humid <= 69.9;
            
            if (!tempOk || !humidOk) {
                let alertType = 'warning';
                let alertTitle = '';
                let alertMessage = '';
                let alertIcon = '‚ö†Ô∏è';
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
                alertCounts.today++;
                alertCounts.week++;
                alertCounts.month++;
                
                if (!tempOk && !humidOk) {
                    alertType = 'error';
                    alertIcon = 'üö®';
                    alertTitle = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥';
                    
                    let tempMsg = temp > 29.9 ? `‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô: ${temp}¬∞C` : `‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô: ${temp}¬∞C`;
                    let humidMsg = humid > 69.9 ? `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô: ${humid}%` : `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô: ${humid}%`;
                    alertMessage = `${tempMsg}, ${humidMsg}`;
                } else if (!tempOk) {
                    if (temp > 29.9) {
                        alertType = 'error';
                        alertIcon = 'üî•';
                        alertTitle = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ';
                        alertMessage = `${temp}¬∞C - ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô`;
                    } else {
                        alertType = 'warning';
                        alertIcon = '‚ùÑÔ∏è';
                        alertTitle = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ';
                        alertMessage = `${temp}¬∞C - ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô`;
                    }
                } else if (!humidOk) {
                    if (humid > 69.9) {
                        alertType = 'warning';
                        alertIcon = 'üíß';
                        alertTitle = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ';
                        alertMessage = `${humid}% - ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô`;
                    } else {
                        alertType = 'warning';
                        alertIcon = 'üèúÔ∏è';
                        alertTitle = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ';
                        alertMessage = `${humid}% - ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®`;
                    }
                }
                
                addTelegramAlert(alertTitle, alertMessage, alertType, alertIcon, time);
                updateAlertStats();
                saveAlertData(); // Save immediately when new alert is created
            }
        }
        
        async function checkThingSpeakAlerts() {
            try {
                // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak ‡∏Å‡πà‡∏≠‡∏ô
                await refreshThingSpeak();
                
                // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
                const alertsContainer = document.getElementById('telegram-alerts');
                if (alertsContainer.children.length === 1 && alertsContainer.children[0].classList.contains('text-center')) {
                    // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô ‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
                    alertsContainer.innerHTML = '';
                }
                
                addTelegramAlert('üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å ThingSpeak', 
                    '‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'info', '‚ÑπÔ∏è');
                
                console.log('‚úÖ ThingSpeak alerts check completed');
                
            } catch (error) {
                console.error('Error checking ThingSpeak alerts:', error);
                addTelegramAlert('‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡πâ', 
                    '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö ThingSpeak', 'error', '‚ùå');
            }
        }
        
        function addTelegramAlert(title, message, type, customIcon = null, customTime = null) {
            const alertsContainer = document.getElementById('telegram-alerts');
            if (!alertsContainer) return;
            
            const icons = {
                'success': '‚úÖ',
                'warning': '‚ö†Ô∏è',
                'error': 'üö®',
                'info': '‚ÑπÔ∏è'
            };
            
            const displayIcon = customIcon || icons[type];
            const displayTime = customTime || new Date().toLocaleTimeString('th-TH');
            const timestamp = new Date().getTime();
            
            // Add to alert history
            const alertData = {
                title: title,
                message: message,
                type: type,
                icon: displayIcon,
                timestamp: timestamp,
                time: displayTime
            };
            
            alertHistory.unshift(alertData); // Add to beginning of array
            
            // Keep only last 50 alerts in memory
            if (alertHistory.length > 50) {
                alertHistory = alertHistory.slice(0, 50);
            }
            
            // Clean old alerts (older than 1 day)
            cleanOldAlerts();
            
            // Update display
            displayAlertHistory();
            
            // Save to localStorage
            saveAlertData();
        }
        
        function updateAlertStats() {
            const todayElement = document.getElementById('alerts-today');
            const weekElement = document.getElementById('alerts-week');
            const monthElement = document.getElementById('alerts-month');
            const recommendationElement = document.getElementById('recommendation');
            
            if (todayElement) {
                todayElement.textContent = `${alertCounts.today} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                todayElement.className = alertCounts.today > 0 ? 'font-semibold text-orange-500' : 'font-semibold text-green-600';
            }
            
            if (weekElement) {
                weekElement.textContent = `${alertCounts.week} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                weekElement.className = alertCounts.week > 0 ? 'font-semibold text-orange-500' : 'font-semibold text-green-600';
            }
            
            if (monthElement) {
                monthElement.textContent = `${alertCounts.month} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
                monthElement.className = alertCounts.month > 0 ? 'font-semibold text-orange-500' : 'font-semibold text-green-600';
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
            if (recommendationElement) {
                if (alertCounts.today === 0) {
                    recommendationElement.textContent = '‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô';
                    recommendationElement.className = 'text-xs text-green-600 mt-1';
                } else if (alertCounts.today <= 3) {
                    recommendationElement.textContent = '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå';
                    recommendationElement.className = 'text-xs text-yellow-600 mt-1';
                } else {
                    recommendationElement.textContent = '‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ö‡πà‡∏≠‡∏¢ ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô';
                    recommendationElement.className = 'text-xs text-red-600 mt-1';
                }
            }
        }
        
        // Clear alert history function
        function clearAlertHistory() {
            if (confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î')) {
                // Clear all data
                alertHistory = [];
                alertCounts = { today: 0, week: 0, month: 0 };
                
                // Save to localStorage
                saveAlertData();
                
                // Update display
                displayAlertHistory();
                updateAlertStats();
                
                // Show confirmation
                addTelegramAlert('üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 
                    '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success', '‚úÖ');
            }
        }
        
        // Global chart variables
        let tempChart = null;
        let humidChart = null;
        
        // Update ThingSpeak charts with real data
        function updateThingSpeakCharts(feeds) {
            if (!feeds || feeds.length === 0) return;
            
            // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏£‡∏≤‡∏ü (‡πÄ‡∏≠‡∏≤ 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)
            const chartData = feeds.slice(-10).map(feed => ({
                time: new Date(feed.created_at).toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }),
                temp: parseFloat(feed.field1) || 0,
                humid: parseFloat(feed.field2) || 0
            }));
            
            const labels = chartData.map(d => d.time);
            const tempData = chartData.map(d => d.temp);
            const humidData = chartData.map(d => d.humid);
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥
            if (tempChart) {
                tempChart.data.labels = labels;
                tempChart.data.datasets[0].data = tempData;
                tempChart.update();
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô
            if (humidChart) {
                humidChart.data.labels = labels;
                humidChart.data.datasets[0].data = humidData;
                humidChart.update();
            }
        }
        
        // Generate sample charts when API fails
        function generateSampleThingSpeakCharts() {
            const now = new Date();
            const labels = [];
            const tempData = [];
            const humidData = [];
            
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 10 ‡∏à‡∏∏‡∏î‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á
            for (let i = 9; i >= 0; i--) {
                const time = new Date(now.getTime() - (i * 5 * 60000)); // ‡∏ó‡∏∏‡∏Å 5 ‡∏ô‡∏≤‡∏ó‡∏µ
                labels.push(time.toLocaleTimeString('th-TH', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                }));
                tempData.push(parseFloat((Math.random() * 10 + 20).toFixed(1)));
                humidData.push(Math.floor(Math.random() * 30 + 50));
            }
            
            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏£‡∏≤‡∏ü
            if (tempChart) {
                tempChart.data.labels = labels;
                tempChart.data.datasets[0].data = tempData;
                tempChart.update();
            }
            
            if (humidChart) {
                humidChart.data.labels = labels;
                humidChart.data.datasets[0].data = humidData;
                humidChart.update();
            }
        }

        // Initialize charts
        function initCharts() {
            // Trend Chart
            const trendCtx = document.getElementById('trendChart').getContext('2d');
            window.trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['‡∏à', '‡∏≠', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™', '‡∏≠‡∏≤'],
                    datasets: [{
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (¬∞C)',
                        data: [23, 25, 24, 26, 25, 27, 26],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: false,
                        pointBackgroundColor: '#EF4444',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        yAxisID: 'y'
                    }, {
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (%)',
                        data: [65, 68, 62, 70, 67, 72, 69],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: false,
                        pointBackgroundColor: '#06B6D4',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#06B6D4',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${context.parsed.y}¬∞C`;
                                    } else {
                                        return `üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${context.parsed.y}%`;
                                    }
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                                color: '#EF4444'
                            },
                            ticks: {
                                color: '#EF4444'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)',
                                color: '#06B6D4'
                            },
                            ticks: {
                                color: '#06B6D4'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå'
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
            
            // Temperature Chart
            const tempCtx = document.getElementById('tempChart').getContext('2d');
            tempChart = new Chart(tempCtx, {
                type: 'line',
                data: {
                    labels: ['12:00', '13:00', '14:00', '15:00', '16:00'],
                    datasets: [{
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                        data: [24, 25, 26, 25, 26],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#EF4444',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#EF4444',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥: ${context.parsed.y}¬∞C`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                                color: '#EF4444'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡πÄ‡∏ß‡∏•‡∏≤'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        }
                    }
                }
            });
            
            // Humidity Chart
            const humidCtx = document.getElementById('humidChart').getContext('2d');
            humidChart = new Chart(humidCtx, {
                type: 'line',
                data: {
                    labels: ['12:00', '13:00', '14:00', '15:00', '16:00'],
                    datasets: [{
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)',
                        data: [65, 68, 70, 68, 68],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#06B6D4',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#06B6D4',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô: ${context.parsed.y}%`;
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)',
                                color: '#06B6D4'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡πÄ‡∏ß‡∏•‡∏≤'
                            },
                            ticks: {
                                color: '#666666'
                            }
                        }
                    }
                }
            });
            
            // Analytics Chart
            const analyticsCtx = document.getElementById('analyticsChart').getContext('2d');
            analyticsChart = new Chart(analyticsCtx, {
                type: 'line',
                data: {
                    labels: ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå', '‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'],
                    datasets: [{
                        label: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (¬∞C)',
                        data: [24.2, 25.1, 24.8, 26.3, 25.7, 27.1, 26.5],
                        borderColor: '#EF4444',
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        tension: 0.4,
                        fill: false,
                        pointBackgroundColor: '#EF4444',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        yAxisID: 'y'
                    }, {
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (%)',
                        data: [65, 68, 62, 70, 67, 72, 69],
                        borderColor: '#06B6D4',
                        backgroundColor: 'rgba(6, 182, 212, 0.1)',
                        tension: 0.4,
                        fill: false,
                        pointBackgroundColor: '#06B6D4',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { 
                        legend: { 
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#06B6D4',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    if (context.datasetIndex === 0) {
                                        return `üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${context.parsed.y}¬∞C`;
                                    } else {
                                        return `üíß ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${context.parsed.y}%`;
                                    }
                                }
                            }
                        }
                    },
                    scales: { 
                        y: { 
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥ (¬∞C)',
                                color: '#EF4444'
                            },
                            ticks: {
                                color: '#EF4444'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô (%)',
                                color: '#06B6D4'
                            },
                            ticks: {
                                color: '#06B6D4'
                            },
                            grid: {
                                drawOnChartArea: false,
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: '‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå'
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
            
            // Initialize weekly analytics
            initializeWeeklyAnalytics();
        }
        
        // Weekly Analytics Functions
        function initializeWeeklyAnalytics() {
            // Load data from Google Sheets for analytics
            loadAnalyticsFromSheets();
        }
        
        // Refresh Analytics Function
        async function refreshAnalytics() {
            updateAIStatus('loading', 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets...');
            await loadAnalyticsFromSheets();
        }
        
        function updateAIStatus(status, message) {
            const indicator = document.getElementById('ai-status-indicator');
            const statusText = document.getElementById('ai-analysis-status');
            const timeElement = document.getElementById('last-analysis-time');
            
            if (indicator && statusText) {
                switch(status) {
                    case 'loading':
                        indicator.className = 'w-2 h-2 bg-yellow-400 rounded-full mr-2 animate-pulse';
                        statusText.textContent = message;
                        break;
                    case 'success':
                        indicator.className = 'w-2 h-2 bg-green-400 rounded-full mr-2';
                        statusText.textContent = message;
                        if (timeElement) {
                            timeElement.textContent = `‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: ${new Date().toLocaleTimeString('th-TH')}`;
                        }
                        break;
                    case 'error':
                        indicator.className = 'w-2 h-2 bg-red-400 rounded-full mr-2';
                        statusText.textContent = message;
                        break;
                }
            }
        }
        
        async function loadAnalyticsFromSheets() {
            try {
                updateAIStatus('loading', 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Google Sheets...');
                
                const sheetId = '1aS2Fw7cmMvHVUtZpycuaN6nvGWNTrU0g0RazCBvmNK4';
                const csvUrl = `https://docs.google.com/spreadsheets/d/1aS2Fw7cmMvHVUtZpycuaN6nvGWNTrU0g0RazCBvmNK4/export?format=csv&gid=0`;
                
                try {
                    const response = await fetch(csvUrl);
                    if (response.ok) {
                        const csvData = await response.text();
                        const rows = csvData.split('\n').filter(row => row.trim() !== '');
                        
                        updateAIStatus('loading', 'AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                        
                        // Process Google Sheets data for analytics with AI analysis
                        await processAnalyticsDataWithAI(rows);
                        
                        updateAIStatus('success', 'AI ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Google Sheets');
                        console.log('‚úÖ Analytics data loaded and analyzed from Google Sheets');
                    } else {
                        throw new Error('Cannot access Google Sheets');
                    }
                } catch (fetchError) {
                    updateAIStatus('error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÑ‡∏î‡πâ - ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á');
                    generateSampleAnalyticsData();
                    console.log('üìä Using sample data for Analytics');
                }
            } catch (error) {
                console.error('Error loading analytics data:', error);
                updateAIStatus('error', '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå');
                generateSampleAnalyticsData();
            }
        }
        
        async function processAnalyticsDataWithAI(rows) {
            if (rows.length < 2) {
                generateSampleAnalyticsData();
                return;
            }
            
            const dataRows = rows.slice(1); // Remove header
            
            // Process data for 5 weeks with AI analysis
            for (let week = 0; week < 5; week++) {
                weeklyAnalyticsData[week] = await processWeeklyDataFromSheetsWithAI(dataRows, week);
                
                // Add small delay to simulate AI processing
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            updateAnalyticsDisplay();
        }
        
        function processAnalyticsData(rows) {
            if (rows.length < 2) {
                generateSampleAnalyticsData();
                return;
            }
            
            const dataRows = rows.slice(1); // Remove header
            
            // Process data for 5 weeks
            for (let week = 0; week < 5; week++) {
                weeklyAnalyticsData[week] = processWeeklyDataFromSheets(dataRows, week);
            }
            
            updateAnalyticsDisplay();
        }
        
        async function processWeeklyDataFromSheetsWithAI(dataRows, weekOffset) {
            const weekData = await processWeeklyDataFromSheets(dataRows, weekOffset);
            
            // AI-powered analysis enhancement
            const aiAnalysis = performAIAnalysis(weekData);
            weekData.aiInsights = aiAnalysis.insights;
            weekData.aiRecommendations = aiAnalysis.recommendations;
            weekData.riskLevel = aiAnalysis.riskLevel;
            weekData.summary = aiAnalysis.summary;
            
            return weekData;
        }
        
        function performAIAnalysis(weekData) {
            const analysis = weekData.analysis;
            const insights = [];
            const recommendations = [];
            let riskLevel = 'low';
            let summary = '';
            
            // AI Analysis Logic
            
            // Temperature Analysis
            const tempVariation = analysis.maxTemp - analysis.minTemp;
            const tempOutOfRange = 7 - analysis.tempNormalDays;
            
            if (tempVariation > 10) {
                insights.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡πÅ‡∏õ‡∏£‡∏™‡∏π‡∏á (${tempVariation.toFixed(1)}¬∞C) ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏¢‡∏≤`);
                recommendations.push('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÅ‡∏•‡∏∞‡∏â‡∏ô‡∏ß‡∏ô‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô');
                riskLevel = 'medium';
            }
            
            if (analysis.avgTemp > 28) {
                insights.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏™‡∏π‡∏á (${analysis.avgTemp}¬∞C) ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô`);
                recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏¢‡πá‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÇ‡∏°‡∏™‡πÅ‡∏ï‡∏ï');
                riskLevel = 'medium';
            } else if (analysis.avgTemp < 22) {
                insights.push(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥ (${analysis.avgTemp}¬∞C) ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏™‡∏∞‡∏™‡∏°`);
                recommendations.push('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®');
            }
            
            if (tempOutOfRange > 2) {
                insights.push(`‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ${tempOutOfRange} ‡∏ß‡∏±‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ`);
                recommendations.push('‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô');
                riskLevel = 'high';
            }
            
            // Humidity Analysis
            const humidVariation = analysis.maxHumid - analysis.minHumid;
            const humidOutOfRange = 7 - analysis.humidNormalDays;
            
            if (humidVariation > 25) {
                insights.push(`‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏±‡∏ô‡πÅ‡∏õ‡∏£‡∏™‡∏π‡∏á (${humidVariation}%) ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û`);
                recommendations.push('‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥');
                riskLevel = riskLevel === 'high' ? 'high' : 'medium';
            }
            
            if (analysis.avgHumid > 65) {
                insights.push(`‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏™‡∏π‡∏á (${analysis.avgHumid}%) ‡∏≠‡∏≤‡∏à‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡∏£‡∏≤`);
                recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡∏î‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô');
            } else if (analysis.avgHumid < 55) {
                insights.push(`‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡∏ï‡πà‡∏≥ (${analysis.avgHumid}%) ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ`);
                recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÉ‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏û‡πà‡∏ô‡πÑ‡∏≠‡∏ô‡πâ‡∏≥');
            }
            
            if (humidOutOfRange > 2) {
                insights.push(`‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ${humidOutOfRange} ‡∏ß‡∏±‡∏ô ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏µ‡πà‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ`);
                recommendations.push('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô');
                riskLevel = 'high';
            }
            
            // Pattern Analysis
            const tempTrend = calculateTrend(weekData.tempData);
            const humidTrend = calculateTrend(weekData.humidData);
            
            if (tempTrend > 0.5) {
                insights.push('‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á');
                recommendations.push('‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÅ‡∏ú‡∏ô‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏Å‡∏±‡∏ö‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï');
            } else if (tempTrend < -0.5) {
                insights.push('‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏•‡∏î‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á');
                recommendations.push('‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ï‡πà‡∏≥‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ');
            }
            
            if (humidTrend > 2) {
                insights.push('‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á');
                recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô');
            } else if (humidTrend < -2) {
                insights.push('‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏•‡∏î‡∏•‡∏á‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á');
                recommendations.push('‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏´‡πâ‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ');
            }
            
            // Overall Risk Assessment
            const overallScore = weekData.score;
            if (overallScore >= 90) {
                summary = '‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£‡∏™‡∏π‡∏á ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏¢‡∏≤';
                riskLevel = riskLevel === 'high' ? 'medium' : 'low';
            } else if (overallScore >= 75) {
                summary = '‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢';
                riskLevel = riskLevel === 'low' ? 'medium' : riskLevel;
            } else if (overallScore >= 60) {
                summary = '‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á';
                riskLevel = 'medium';
            } else {
                summary = '‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ï‡πà‡∏≠‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏¢‡∏≤';
                riskLevel = 'high';
            }
            
            // Add general recommendations based on risk level
            if (riskLevel === 'high') {
                recommendations.unshift('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏ä‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô');
                recommendations.push('‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≤‡∏¢‡∏¢‡∏≤‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏≥‡∏£‡∏≠‡∏á');
            } else if (riskLevel === 'medium') {
                recommendations.push('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö');
                recommendations.push('‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ä‡∏¥‡∏á‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô');
            } else {
                recommendations.push('‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥');
                recommendations.push('‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ï‡πà‡∏≠‡πÑ‡∏õ');
            }
            
            return {
                insights: insights,
                recommendations: recommendations,
                riskLevel: riskLevel,
                summary: summary
            };
        }
        
        function calculateTrend(data) {
            if (data.length < 2) return 0;
            
            let sumX = 0, sumY = 0, sumXY = 0, sumXX = 0;
            const n = data.length;
            
            for (let i = 0; i < n; i++) {
                sumX += i;
                sumY += data[i];
                sumXY += i * data[i];
                sumXX += i * i;
            }
            
            const slope = (n * sumXY - sumX * sumY) / (n * sumXX - sumX * sumX);
            return slope;
        }
        
        function processWeeklyDataFromSheets(dataRows, weekOffset) {
            const weekData = {
                tempData: [],
                humidData: [],
                weekRange: '',
                score: 0,
                summary: '',
                analysis: {
                    avgTemp: 0,
                    maxTemp: 0,
                    minTemp: 0,
                    tempNormalDays: 0,
                    avgHumid: 0,
                    maxHumid: 0,
                    minHumid: 0,
                    humidNormalDays: 0,
                    totalRecords: 0,
                    alertCount: 0
                }
            };
            
            // Calculate week range
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() - (weekOffset * 7));
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            weekData.weekRange = `${startOfWeek.getDate()}-${endOfWeek.getDate()} ${startOfWeek.toLocaleDateString('th-TH', { month: 'short' })} ${startOfWeek.getFullYear() + 543}`;
            
            // Group data by day for this week
            const dailyData = {};
            for (let day = 0; day < 7; day++) {
                const date = new Date(startOfWeek);
                date.setDate(startOfWeek.getDate() + day);
                const dateStr = date.toLocaleDateString('en-CA'); // YYYY-MM-DD
                dailyData[dateStr] = { temps: [], humids: [] };
            }
            
            // Process Google Sheets data
            dataRows.forEach(row => {
                const cols = row.split(',');
                const date = cols[0];
                const temp = parseFloat(cols[2]);
                const humid = parseInt(cols[3]);
                
                if (dailyData[date] && !isNaN(temp) && !isNaN(humid)) {
                    dailyData[date].temps.push(temp);
                    dailyData[date].humids.push(humid);
                }
            });
            
            // Calculate daily averages and statistics
            let tempSum = 0, humidSum = 0, tempNormalDays = 0, humidNormalDays = 0;
            let maxTemp = -Infinity, minTemp = Infinity;
            let maxHumid = -Infinity, minHumid = Infinity;
            let totalRecords = 0, alertCount = 0;
            let validDays = 0;
            
            Object.keys(dailyData).forEach(date => {
                const dayData = dailyData[date];
                
                if (dayData.temps.length > 0) {
                    const avgTemp = dayData.temps.reduce((a, b) => a + b, 0) / dayData.temps.length;
                    const avgHumid = dayData.humids.reduce((a, b) => a + b, 0) / dayData.humids.length;
                    
                    weekData.tempData.push(parseFloat(avgTemp.toFixed(1)));
                    weekData.humidData.push(Math.round(avgHumid));
                    
                    tempSum += avgTemp;
                    humidSum += avgHumid;
                    validDays++;
                    
                    maxTemp = Math.max(maxTemp, avgTemp);
                    minTemp = Math.min(minTemp, avgTemp);
                    maxHumid = Math.max(maxHumid, avgHumid);
                    minHumid = Math.min(minHumid, avgHumid);
                    
                    // Check if within normal range
                    if (avgTemp >= 20 && avgTemp <= 29.9) tempNormalDays++;
                    if (avgHumid >= 50 && avgHumid <= 69.9) humidNormalDays++;
                    
                    totalRecords += dayData.temps.length;
                    
                    // Count alerts
                    if (avgTemp < 20 || avgTemp > 29.9 || avgHumid < 50 || avgHumid > 69.9) {
                        alertCount++;
                    }
                } else {
                    // Use sample data for days without data
                    const sampleTemp = parseFloat((Math.random() * 8 + 20).toFixed(1));
                    const sampleHumid = Math.floor(Math.random() * 30 + 50);
                    
                    weekData.tempData.push(sampleTemp);
                    weekData.humidData.push(sampleHumid);
                    
                    tempSum += sampleTemp;
                    humidSum += sampleHumid;
                    validDays++;
                    
                    maxTemp = Math.max(maxTemp, sampleTemp);
                    minTemp = Math.min(minTemp, sampleTemp);
                    maxHumid = Math.max(maxHumid, sampleHumid);
                    minHumid = Math.min(minHumid, sampleHumid);
                    
                    if (sampleTemp >= 20 && sampleTemp <= 29.9) tempNormalDays++;
                    if (sampleHumid >= 50 && sampleHumid <= 69.9) humidNormalDays++;
                    
                    totalRecords += Math.floor(Math.random() * 31) + 20;
                }
            });
            
            // Calculate analysis
            if (validDays > 0) {
                weekData.analysis.avgTemp = parseFloat((tempSum / validDays).toFixed(1));
                weekData.analysis.avgHumid = Math.round(humidSum / validDays);
            }
            
            weekData.analysis.maxTemp = parseFloat(maxTemp.toFixed(1));
            weekData.analysis.minTemp = parseFloat(minTemp.toFixed(1));
            weekData.analysis.tempNormalDays = tempNormalDays;
            
            weekData.analysis.maxHumid = Math.round(maxHumid);
            weekData.analysis.minHumid = Math.round(minHumid);
            weekData.analysis.humidNormalDays = humidNormalDays;
            
            weekData.analysis.totalRecords = totalRecords;
            weekData.analysis.alertCount = alertCount;
            
            // Calculate quality score
            const tempScore = (tempNormalDays / 7) * 50;
            const humidScore = (humidNormalDays / 7) * 50;
            weekData.score = Math.round(tempScore + humidScore);
            
            // Generate summary
            if (weekData.score >= 90) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets)';
            } else if (weekData.score >= 75) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets)';
            } else if (weekData.score >= 60) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets)';
            } else {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets)';
            }
            
            return weekData;
        }
        
        function generateSampleAnalyticsData() {
            // Generate sample data for 5 weeks when Google Sheets is not available
            for (let week = 0; week < 5; week++) {
                weeklyAnalyticsData[week] = generateWeeklyData(week);
            }
            updateAnalyticsDisplay();
        }
        
        function generateWeeklyData(weekOffset) {
            const weekData = {
                tempData: [],
                humidData: [],
                weekRange: '',
                score: 0,
                summary: '',
                analysis: {
                    avgTemp: 0,
                    maxTemp: 0,
                    minTemp: 0,
                    tempNormalDays: 0,
                    avgHumid: 0,
                    maxHumid: 0,
                    minHumid: 0,
                    humidNormalDays: 0,
                    totalRecords: 0,
                    alertCount: 0
                }
            };
            
            // Calculate week range
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay() - (weekOffset * 7));
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            weekData.weekRange = `${startOfWeek.getDate()}-${endOfWeek.getDate()} ${startOfWeek.toLocaleDateString('th-TH', { month: 'short' })} ${startOfWeek.getFullYear() + 543}`;
            
            // Generate daily data for the week
            let tempSum = 0, humidSum = 0, tempNormalDays = 0, humidNormalDays = 0;
            let maxTemp = -Infinity, minTemp = Infinity;
            let maxHumid = -Infinity, minHumid = Infinity;
            let totalRecords = 0, alertCount = 0;
            
            for (let day = 0; day < 7; day++) {
                // Generate realistic data with some variation based on week
                const baseTemp = 25 + (Math.random() * 6 - 3) + (weekOffset * 0.5); // Slight trend over weeks
                const baseHumid = 65 + (Math.random() * 20 - 10) + (weekOffset * -1); // Decreasing humidity trend
                
                const dayTemp = Math.max(18, Math.min(35, baseTemp));
                const dayHumid = Math.max(30, Math.min(85, baseHumid));
                
                weekData.tempData.push(parseFloat(dayTemp.toFixed(1)));
                weekData.humidData.push(Math.round(dayHumid));
                
                tempSum += dayTemp;
                humidSum += dayHumid;
                
                maxTemp = Math.max(maxTemp, dayTemp);
                minTemp = Math.min(minTemp, dayTemp);
                maxHumid = Math.max(maxHumid, dayHumid);
                minHumid = Math.min(minHumid, dayHumid);
                
                // Check if within normal range
                if (dayTemp >= 20 && dayTemp <= 29.9) tempNormalDays++;
                if (dayHumid >= 50 && dayHumid <= 69.9) humidNormalDays++;
                
                // Simulate daily records (20-50 per day)
                const dailyRecords = Math.floor(Math.random() * 31) + 20;
                totalRecords += dailyRecords;
                
                // Simulate alerts based on conditions
                if (dayTemp < 20 || dayTemp > 29.9 || dayHumid < 50 || dayHumid > 69.9) {
                    alertCount += Math.floor(Math.random() * 5) + 1;
                }
            }
            
            // Calculate analysis
            weekData.analysis.avgTemp = parseFloat((tempSum / 7).toFixed(1));
            weekData.analysis.maxTemp = parseFloat(maxTemp.toFixed(1));
            weekData.analysis.minTemp = parseFloat(minTemp.toFixed(1));
            weekData.analysis.tempNormalDays = tempNormalDays;
            
            weekData.analysis.avgHumid = Math.round(humidSum / 7);
            weekData.analysis.maxHumid = Math.round(maxHumid);
            weekData.analysis.minHumid = Math.round(minHumid);
            weekData.analysis.humidNormalDays = humidNormalDays;
            
            weekData.analysis.totalRecords = totalRecords;
            weekData.analysis.alertCount = alertCount;
            
            // Calculate quality score
            const tempScore = (tempNormalDays / 7) * 50;
            const humidScore = (humidNormalDays / 7) * 50;
            weekData.score = Math.round(tempScore + humidScore);
            
            // Generate summary
            if (weekData.score >= 90) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°';
            } else if (weekData.score >= 75) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ ‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢';
            } else if (weekData.score >= 60) {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°';
            } else {
                weekData.summary = '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç';
            }
            
            return weekData;
        }
        
        function changeAnalyticsWeek() {
            const selector = document.getElementById('weekSelector');
            currentWeekOffset = parseInt(selector.value);
            updateAnalyticsDisplay();
        }
        

        
        function updateAnalyticsDisplay() {
            const weekData = weeklyAnalyticsData[currentWeekOffset];
            if (!weekData) return;
            
            // Update week title and summary
            const weekNames = ['‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ', '‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', '2 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', '3 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', '4 ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß'];
            document.getElementById('current-week-title').textContent = `${weekNames[currentWeekOffset]} (${weekData.weekRange})`;
            document.getElementById('week-summary').textContent = weekData.summary;
            document.getElementById('week-score').textContent = `${weekData.score}%`;
            
            // Update chart
            if (analyticsChart) {
                analyticsChart.data.datasets[0].data = weekData.tempData;
                analyticsChart.data.datasets[1].data = weekData.humidData;
                analyticsChart.update();
            }
            
            // Update analysis cards
            updateAnalysisCards(weekData.analysis);
            
            // Update AI insights and recommendations
            updateAIInsights(weekData);
        }
        
        function updateAIInsights(weekData) {
            // Update risk level indicator
            const riskIndicator = document.getElementById('risk-indicator');
            const riskLevelText = document.getElementById('risk-level-text');
            const aiInsights = document.getElementById('ai-insights');
            const aiRecommendations = document.getElementById('ai-recommendations');
            const aiSummary = document.getElementById('ai-summary');
            
            if (weekData.riskLevel) {
                const riskColors = {
                    'low': 'bg-green-400',
                    'medium': 'bg-yellow-400', 
                    'high': 'bg-red-400'
                };
                
                const riskTexts = {
                    'low': '‡∏ï‡πà‡∏≥',
                    'medium': '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á',
                    'high': '‡∏™‡∏π‡∏á'
                };
                
                if (riskIndicator) {
                    riskIndicator.className = `w-2 h-2 rounded-full ${riskColors[weekData.riskLevel]}`;
                }
                
                if (riskLevelText) {
                    riskLevelText.textContent = `‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á: ${riskTexts[weekData.riskLevel]}`;
                }
            }
            
            // Update AI insights
            if (aiInsights && weekData.aiInsights) {
                aiInsights.innerHTML = '';
                weekData.aiInsights.forEach(insight => {
                    const p = document.createElement('p');
                    p.textContent = `‚Ä¢ ${insight}`;
                    aiInsights.appendChild(p);
                });
                
                if (weekData.aiInsights.length === 0) {
                    aiInsights.innerHTML = '<p>‚Ä¢ ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</p>';
                }
            }
            
            // Update AI recommendations
            if (aiRecommendations && weekData.aiRecommendations) {
                aiRecommendations.innerHTML = '';
                weekData.aiRecommendations.forEach(recommendation => {
                    const p = document.createElement('p');
                    p.textContent = `‚Ä¢ ${recommendation}`;
                    aiRecommendations.appendChild(p);
                });
                
                if (weekData.aiRecommendations.length === 0) {
                    aiRecommendations.innerHTML = '<p>‚Ä¢ ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥</p>';
                }
            }
            
            // Update AI summary
            if (aiSummary && weekData.summary) {
                aiSummary.textContent = weekData.summary;
            }
        }
        
        function updateAnalysisCards(analysis) {
            // Temperature analysis
            document.getElementById('analytics-avg-temp').textContent = `${analysis.avgTemp}¬∞C`;
            document.getElementById('analytics-max-temp').textContent = `${analysis.maxTemp}¬∞C`;
            document.getElementById('analytics-min-temp').textContent = `${analysis.minTemp}¬∞C`;
            document.getElementById('analytics-temp-normal').textContent = `${analysis.tempNormalDays}/7 ‡∏ß‡∏±‡∏ô`;
            
            // Humidity analysis
            document.getElementById('analytics-avg-humid').textContent = `${analysis.avgHumid}%`;
            document.getElementById('analytics-max-humid').textContent = `${analysis.maxHumid}%`;
            document.getElementById('analytics-min-humid').textContent = `${analysis.minHumid}%`;
            document.getElementById('analytics-humid-normal').textContent = `${analysis.humidNormalDays}/7 ‡∏ß‡∏±‡∏ô`;
            
            // Update quality score
            document.getElementById('quality-score').textContent = `${Math.round((analysis.tempNormalDays + analysis.humidNormalDays) / 14 * 100)}%`;
            
            // Generate recommendations
            let tempAnalysis = '';
            let humidAnalysis = '';
            
            if (analysis.tempNormalDays >= 6) {
                tempAnalysis = '‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
            } else if (analysis.tempNormalDays >= 4) {
                tempAnalysis = `‡∏°‡∏µ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ${7 - analysis.tempNormalDays} ‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö`;
            } else {
                tempAnalysis = `‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏ö‡πà‡∏≠‡∏¢ ${7 - analysis.tempNormalDays} ‡∏ß‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö`;
            }
            
            if (analysis.humidNormalDays >= 6) {
                humidAnalysis = '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡∏ï‡∏•‡∏≠‡∏î‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå';
            } else if (analysis.humidNormalDays >= 4) {
                humidAnalysis = `‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ${7 - analysis.humidNormalDays} ‡∏ß‡∏±‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏ö‡∏ö`;
            } else {
                humidAnalysis = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏ö‡πà‡∏≠‡∏¢ ${7 - analysis.humidNormalDays} ‡∏ß‡∏±‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö`;
            }
            
            document.getElementById('temp-analysis').textContent = tempAnalysis;
            document.getElementById('humid-analysis').textContent = humidAnalysis;
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9779e0f3673b272d',t:'MTc1NjYxNTUyOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
